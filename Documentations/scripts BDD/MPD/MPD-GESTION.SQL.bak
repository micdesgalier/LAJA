DROP DATABASE IF EXISTS LAJA_GESTION;

CREATE DATABASE IF NOT EXISTS LAJA_GESTION;
USE LAJA_GESTION;
# -----------------------------------------------------------------------------
#       TABLE : UTILISATEUR
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS UTILISATEUR
 (
   ID_UTILISATEUR INTEGER NOT NULL AUTO_INCREMENT ,
   LOGIN VARCHAR(128) NOT NULL  ,
   MOT_DE_PASSE CHAR(255) NOT NULL  ,
   TYPE BOOL NOT NULL  
   , PRIMARY KEY (ID_UTILISATEUR) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       TABLE : CODE
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS CODE
 (
   ID_CODE INTEGER NOT NULL AUTO_INCREMENT ,
   ID_SONDAGE INTEGER NOT NULL  ,
   ID_UTILISATEUR INTEGER NOT NULL  ,
   CODE CHAR(255) NOT NULL  
   , PRIMARY KEY (ID_CODE) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE CODE
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_CODE_SONDAGE
     ON CODE (ID_SONDAGE ASC);

CREATE  INDEX I_FK_CODE_UTILISATEUR
     ON CODE (ID_UTILISATEUR ASC);

# -----------------------------------------------------------------------------
#       TABLE : QUESTION
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS QUESTION
 (
   ID_QUESTION INTEGER NOT NULL AUTO_INCREMENT ,
   ID_SONDAGE INTEGER NOT NULL  ,
   QUESTION VARCHAR(128) NOT NULL  
   , PRIMARY KEY (ID_QUESTION) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE QUESTION
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_QUESTION_SONDAGE
     ON QUESTION (ID_SONDAGE ASC);

# -----------------------------------------------------------------------------
#       TABLE : CHOIX
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS CHOIX
 (
   ID_CHOIX INTEGER NOT NULL AUTO_INCREMENT ,
   ID_QUESTION INTEGER NOT NULL  ,
   CHOIX VARCHAR(100) NOT NULL  ,
   NB_CHOISI INTEGER NOT NULL  
      DEFAULT 0
   , PRIMARY KEY (ID_CHOIX) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE CHOIX
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_CHOIX_QUESTION
     ON CHOIX (ID_QUESTION ASC);

# -----------------------------------------------------------------------------
#       TABLE : SONDAGE
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS SONDAGE
 (
   ID_SONDAGE INTEGER NOT NULL AUTO_INCREMENT ,
   ID_UTILISATEUR INTEGER NOT NULL  ,
   SUJET VARCHAR(100) NOT NULL  ,
   OUVERT BOOL NOT NULL  ,
   BLOQUE BOO(1) NOT NULL  
   , PRIMARY KEY (ID_SONDAGE) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE SONDAGE
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_SONDAGE_UTILISATEUR
     ON SONDAGE (ID_UTILISATEUR ASC);

# -----------------------------------------------------------------------------
#       TABLE : GÉNERER
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS GÉNERER
 (
   ID_SONDAGE INTEGER NOT NULL  ,
   ID_CODE INTEGER NOT NULL  
   , PRIMARY KEY (ID_SONDAGE,ID_CODE) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE GÉNERER
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_GÉNERER_SONDAGE
     ON GÉNERER (ID_SONDAGE ASC);

CREATE  INDEX I_FK_GÉNERER_CODE
     ON GÉNERER (ID_CODE ASC);


# -----------------------------------------------------------------------------
#       CREATION DES REFERENCES DE TABLE
# -----------------------------------------------------------------------------


ALTER TABLE CODE 
  ADD FOREIGN KEY FK_CODE_SONDAGE (ID_SONDAGE)
      REFERENCES SONDAGE (ID_SONDAGE) ;


ALTER TABLE CODE 
  ADD FOREIGN KEY FK_CODE_UTILISATEUR (ID_UTILISATEUR)
      REFERENCES UTILISATEUR (ID_UTILISATEUR) ;


ALTER TABLE QUESTION 
  ADD FOREIGN KEY FK_QUESTION_SONDAGE (ID_SONDAGE)
      REFERENCES SONDAGE (ID_SONDAGE) ;


ALTER TABLE CHOIX 
  ADD FOREIGN KEY FK_CHOIX_QUESTION (ID_QUESTION)
      REFERENCES QUESTION (ID_QUESTION) ;


ALTER TABLE SONDAGE 
  ADD FOREIGN KEY FK_SONDAGE_UTILISATEUR (ID_UTILISATEUR)
      REFERENCES UTILISATEUR (ID_UTILISATEUR) ;


ALTER TABLE GÉNERER 
  ADD FOREIGN KEY FK_GÉNERER_SONDAGE (ID_SONDAGE)
      REFERENCES SONDAGE (ID_SONDAGE) ;


ALTER TABLE GÉNERER 
  ADD FOREIGN KEY FK_GÉNERER_CODE (ID_CODE)
      REFERENCES CODE (ID_CODE) ;

